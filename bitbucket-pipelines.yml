image: node:18

pipelines:
  default:
    - parallel:
        - step:
            name: "Build Frontend"
            caches:
              - node
            script:
              - cd frontend
              - npm install
              - npm run build
            artifacts:
              - frontend/build/**
        - step:
            name: "Test Backend"
            script:
              - cd backend
              - python -m pip install -r requirements.txt
              - pytest

    - step:
        name: "Deploy to Vercel"
        deployment: production
        trigger: manual
        script:
          - npm install -g vercel
          - cd frontend
          - vercel --prod --token=$VERCEL_TOKEN --yes
          - cd ../backend
          - vercel --prod --token=$VERCEL_TOKEN --yes
